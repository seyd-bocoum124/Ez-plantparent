<div>
  <mat-stepper [linear]="true" #stepper (selectionChange)="onStepChange($event)">
    <mat-step [editable]="!reportId">
      <ng-template matStepLabel>PrÃ©paration</ng-template>
      <div>Mettre le sensor dans la terre jusqu'au niveau, votre station doit Ãªtre allumÃ©e.</div>
      @if(isTestingSensor) {
        <div>Test en cours - {{numberOfDataMessages}}/{{TEST_SENSORS_DURATION}}</div>
      } @else {
        <button matButton="filled" (click)="sensorTest('start')">{{ 'Reprendre les test' }}</button>
      }
      <app-express-live-chart></app-express-live-chart>
      <button matButton="filled" matStepperNext>DÃ©buter l'analyse</button>
    </mat-step>
    <mat-step [editable]="!reportId" [completed]="reportId">
      <ng-template matStepLabel>Analyse</ng-template>
      @if(reportId) {
        <div class="analysis-done-message">
          {{ "L'analyse expresse est terminÃ©e. \n Redirection vers les rÃ©sultats" }}
        </div>
        <button matButton="filled" matStepperNext>Voir les rÃ©sultats</button>
      } @else {
        @if(isExpressAnalysis) {
          <mat-progress-bar mode="determinate"
            [value]="(numberOfDataMessages / EXPRESS_ANALYSIS_DURATION) * 100"
            color="primary"></mat-progress-bar>

          <div>{{numberOfDataMessages}}/{{EXPRESS_ANALYSIS_DURATION}}</div>
          <button matButton="filled" (click)="cancelExpressAnalysis()">{{ 'Annuler l\'Analyse' }}</button>
        } @else {
          <button matButton="filled" (click)="cmdExpressAnalysis('start')">{{ 'RedÃ©marrer l\'Analyse expresse' }}</button>
        }
        <app-express-live-chart></app-express-live-chart>
        @if(isExpressAnalysis && data) {
          <mat-chip-listbox>
            <mat-chip selectable="false" class="chip-line">
              <span class="field">{{ data.ts | date:'HH:mm:ss' }}</span>
              ğŸŒ¡ <span class="field">{{ data.raw.temperature | number:'2.2-2' }}</span> Â°C |
              ğŸŒ¬ï¸ air <span class="field">{{ data.raw.air_humidity | number:'2.2-2' }}</span> % |
              ğŸŒ± sol <span class="field">{{ data.raw.humidity | number:'2.2-2' }}</span> % |
            </mat-chip>
          </mat-chip-listbox>
        }
      }
    </mat-step>
    <mat-step [editable]="reportId" [completed]="reportId">
      <ng-template matStepLabel>RÃ©sultats</ng-template>
      @if(reportDeleted) {
        <div>Analyse rejettÃ©!</div>
        <button matButton="filled" (click)="restartAnalysis()">{{ 'Restart an analysis' }}</button>
        <button mat-button [routerLink]="['/my-plants']">Retour Ã  mes plantes</button>
      } @else if(expressAnalysisReport() && reportId) {
        <app-express-live-chart></app-express-live-chart>
          <div>air_humidity_mean : {{ expressAnalysisReport().air_humidity_mean }}</div>
          <div>temperature_mean: {{ expressAnalysisReport().temperature_mean }}</div>
          <div>soil_humidity_mean {{ expressAnalysisReport().soil_humidity_mean }}</div>
          <button matButton="filled" (click)="deleteReport()">{{ 'Delete report' }} - {{reportId}}</button>
          <button
            mat-button
            [routerLink]="['/maintenance-schedule']"
            [queryParams]="{ plantId: plantId }">
            Retour Ã  mes plantes
          </button>
      }
    </mat-step>
  </mat-stepper>
</div>
